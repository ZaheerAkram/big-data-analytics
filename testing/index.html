<!DOCTYPE html>
<html>
<head>
    <title>Mic Toggle Recorder</title>
</head>
<body>
    <h2>Mic Toggle Recorder</h2>
    <button id="toggleBtn">Enable Mic</button>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let stream;

        const toggleBtn = document.getElementById('toggleBtn');

        toggleBtn.onclick = async () => {
            if (!isRecording) {
                // Start recording
                stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = e => {
                    audioChunks.push(e.data);
                };

                mediaRecorder.onstop = async () => {
                    const blob = new Blob(audioChunks, { type: 'audio/wav' });
                    const formData = new FormData();
                    formData.append('audio', blob, 'recording.wav');

                    await fetch('/save-audio', {
                        method: 'POST',
                        body: formData
                    });

                    stream.getTracks().forEach(track => track.stop()); // stop mic access
                };

                mediaRecorder.start();
                toggleBtn.textContent = 'Disable Mic';
                isRecording = true;
            } else {
                // Stop and save
                mediaRecorder.stop();
                toggleBtn.textContent = 'Enable Mic';
                isRecording = false;
            }
        };
    </script>
</body>
</html>
